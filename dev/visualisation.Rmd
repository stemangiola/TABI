---
title: "Results visualisation"
output: html_notebook
---

```{r setup}
devtools::load_all()
library(rstan)
library(tidyverse)
library(here)
model = rstan::stan_model(here::here("src","stan_files","DE_sigmoid.stan"))
load(here("data","prostate_df.rda"))
options(mc.cores = parallel::detectCores())
rstan_options(auto_write = TRUE)
```


# Create a simple fit

```{r}
data_subset = prostate_df[,c(sample(1:214, 15), 215,216)]

fit = TABI_glm( ~ CAPRA_TOTAL + batch, 
                data = data_subset, 
                prior = list( 
                 prop_DE =0.05,
                 scale_DE = 5, 	
                 nu_global = 40,
                 slab_df = 40
                ),
                model = model,
                control = list(adapt_delta = 0.9)
     )
```

```{r}
for(i in 11) {
  plot_generated_gene(fit, colnames(data_subset)[i], type ="lines") %>% print()
}
```

